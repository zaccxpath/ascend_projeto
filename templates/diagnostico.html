<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico do Sistema</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <style>
        .card {
            margin-bottom: 20px;
        }
        .status-success {
            color: #28a745;
        }
        .status-warning {
            color: #ffc107;
        }
        .status-danger {
            color: #dc3545;
        }
        .action-card {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .success-message {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Diagnóstico do Sistema</h1>
        
        {% if mensagem %}
        <div class="success-message">
            <h4>Resultado da Operação</h4>
            <p>{{ mensagem }}</p>
        </div>
        {% endif %}
        
        <div class="card action-card">
            <div class="card-header bg-primary text-white">
                Ações de Manutenção
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Download do Modelo</h5>
                                <p class="card-text">Forçar o download do modelo XLM-RoBERTa para análise de sentimentos.</p>
                                <a href="/baixar-modelo" class="btn btn-primary">Baixar Modelo</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Reiniciar Modelo</h5>
                                <p class="card-text">Reiniciar o analisador de sentimentos após o download.</p>
                                <a href="/reiniciar-modelo" class="btn btn-warning">Reiniciar Modelo</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Verificar Diretórios</h5>
                        <p class="card-text">Verificar e criar diretórios necessários para o funcionamento da aplicação.</p>
                        <a href="/criar_template_diagnostico" class="btn btn-info">Verificar Templates</a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-primary text-white">
                Status do Modelo XLM-RoBERTa
            </div>
            <div class="card-body">
                <h5 class="card-title">Informações do Modelo</h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        XLM-RoBERTa Disponível: 
                        <span class="{% if modelo.xlm_roberta_disponivel %}status-success{% else %}status-danger{% endif %}">
                            {{ "Sim" if modelo.xlm_roberta_disponivel else "Não" }}
                        </span>
                    </li>
                    <li class="list-group-item">
                        Modelo Carregado: 
                        <span class="{% if modelo.modelo_carregado %}status-success{% else %}status-danger{% endif %}">
                            {{ "Sim" if modelo.modelo_carregado else "Não" }}
                        </span>
                    </li>
                    <li class="list-group-item">
                        Versão Python: {{ modelo.python_version }}
                    </li>
                    <li class="list-group-item">
                        Versão Transformers: {{ modelo.transformers_version }}
                    </li>
                    <li class="list-group-item">
                        Teste do Modelo: 
                        <span class="{% if modelo.teste_sucesso %}status-success{% else %}status-danger{% endif %}">
                            {{ "Sucesso" if modelo.teste_sucesso else "Falha" }}
                        </span>
                        {% if modelo.teste_sucesso %}
                            <div class="mt-2">
                                <strong>Label:</strong> {{ modelo.teste_resultado.label }}<br>
                                <strong>Score:</strong> {{ "%.4f"|format(modelo.teste_resultado.score) }}<br>
                                <strong>Tempo:</strong> {{ modelo.teste_resultado.tempo }}
                            </div>
                        {% else %}
                            <div class="mt-2 status-danger">
                                <strong>Erro:</strong> {{ modelo.teste_erro }}
                            </div>
                        {% endif %}
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-info text-white">
                Informações do Sistema
            </div>
            <div class="card-body">
                <h5 class="card-title">Detalhes do Sistema</h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Sistema:</strong> {{ sistema.sistema }}</li>
                    <li class="list-group-item"><strong>Release:</strong> {{ sistema.release }}</li>
                    <li class="list-group-item"><strong>Versão:</strong> {{ sistema.versao }}</li>
                    <li class="list-group-item"><strong>Arquitetura:</strong> {{ sistema.arquitetura[0] }} ({{ sistema.arquitetura[1] }})</li>
                    <li class="list-group-item"><strong>Processador:</strong> {{ sistema.processador }}</li>
                </ul>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-success text-white">
                Status dos Requisitos
            </div>
            <div class="card-body">
                <h5 class="card-title">Bibliotecas Instaladas</h5>
                <ul class="list-group list-group-flush">
                    {% for lib, status in requisitos.items() %}
                    <li class="list-group-item">
                        {{ lib }}: 
                        <span class="{% if status %}status-success{% else %}status-danger{% endif %}">
                            {{ "Instalado" if status else "Não Instalado" }}
                        </span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-warning text-dark">
                Status dos Diretórios
            </div>
            <div class="card-body">
                <h5 class="card-title">Diretórios Necessários</h5>
                <ul class="list-group list-group-flush">
                    {% for dir, exists in diretorios.items() %}
                    <li class="list-group-item">
                        {{ dir }}: 
                        <span class="{% if exists %}status-success{% else %}status-danger{% endif %}">
                            {{ "Existe" if exists else "Não Existe" }}
                        </span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-secondary text-white">
                Testes Adicionais
            </div>
            <div class="card-body">
                <h5 class="card-title">Testar Modelo Manualmente</h5>
                <div class="form-group">
                    <label for="testText">Texto para testar:</label>
                    <textarea class="form-control" id="testText" rows="3" placeholder="Digite um texto para analisar..."></textarea>
                </div>
                <button id="testButton" class="btn btn-primary">Analisar Sentimento</button>
                
                <div id="testResult" class="mt-3" style="display: none;">
                    <h6>Resultado da Análise:</h6>
                    <pre id="resultJson" class="bg-light p-3"></pre>
                </div>
            </div>
        </div>
        
        <div class="mt-4 mb-4">
            <a href="/" class="btn btn-secondary">Voltar para Home</a>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            $("#testButton").click(function() {
                const texto = $("#testText").val();
                if (!texto) {
                    alert("Por favor, digite um texto para analisar.");
                    return;
                }
                
                $("#testButton").prop("disabled", true).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Analisando...');
                
                $.ajax({
                    url: "/api/testar-modelo",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({texto: texto}),
                    success: function(response) {
                        $("#resultJson").text(JSON.stringify(response, null, 2));
                        $("#testResult").show();
                    },
                    error: function(xhr, status, error) {
                        $("#resultJson").text("Erro: " + error);
                        $("#testResult").show();
                    },
                    complete: function() {
                        $("#testButton").prop("disabled", false).text("Analisar Sentimento");
                    }
                });
            });
        });
    </script>
</body>
</html> 